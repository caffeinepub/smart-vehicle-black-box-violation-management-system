{
  "kind": "build_request",
  "title": "Connect dashboard to local /violations API and add score alerts, proof images, challan preview, and notifications",
  "projectName": "Vehicle Safety Black Box",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-10",
      "text": "Update the frontend API integration to fetch violations from the existing Node.js backend using fetch('/violations') (relative URL) and handle the response schema: [{ vehicleNo, ownerName, mobile, violationType, timestamp, score, imageUrl }].",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Must fetch data using:\n   fetch('/violations')",
          "GET /violations → returns JSON array:\n[\n{\nvehicleNo,\nownerName,\nmobile,\nviolationType,\ntimestamp,\nscore,\nimageUrl\n}\n]"
        ]
      },
      "acceptanceCriteria": [
        "The app uses a relative request to '/violations' (not the existing https://vehicle-blackbox-system.onrender.com endpoints) when loading live violation data.",
        "The UI renders violation fields using the Node.js schema keys (vehicleNo, ownerName, mobile, violationType, timestamp, score, imageUrl).",
        "Network errors and non-200 responses show a clear error state instead of a blank screen."
      ]
    },
    {
      "id": "REQ-11",
      "text": "Modify the Live Violations view to match the requested dashboard table: live-updating (auto-refresh every 3 seconds) violations table with columns Time, Vehicle No, Violation Type, Score, Proof Image, and Status.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Live updating violations table (auto refresh every 3 seconds)\n- Columns: Time, Vehicle No, Violation Type, Score, Proof Image, Status"
        ]
      },
      "acceptanceCriteria": [
        "Violations data refreshes every 3 seconds while the user is on the live violations/dashboard view.",
        "The table includes the specified columns and formats Time from the timestamp field into a readable local date/time.",
        "Proof Image displays a thumbnail when an image is available.",
        "Status is displayed for each row (e.g., a badge) and is not empty for any rendered row."
      ]
    },
    {
      "id": "REQ-12",
      "text": "Implement proof image rendering for violations using the Node.js uploads convention. If the API provides a filename, construct the URL as http://localhost:3000/uploads/<filename>; if the API provides a full URL/path, display it as-is.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Images are stored in /uploads folder and accessible via:\nhttp://localhost:3000/uploads/<filename>"
        ]
      },
      "acceptanceCriteria": [
        "For a violation with imageUrl='abc.jpg', the UI requests and displays 'http://localhost:3000/uploads/abc.jpg'.",
        "If imageUrl is already an absolute URL, the UI displays that URL without re-prefixing.",
        "If no imageUrl is present, the UI shows a clear placeholder (e.g., “No image”)."
      ]
    },
    {
      "id": "REQ-13",
      "text": "Add a “Latest Violation” section (violation cards) that always shows the newest violation at the top with a large proof image and key details (vehicle number, violation type, time, score).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Violation Cards\n   Show latest violation at top with large image proof."
        ]
      },
      "acceptanceCriteria": [
        "When at least one violation exists, the newest violation (by timestamp) is displayed prominently above the table.",
        "The latest violation section includes a large proof image when available and falls back gracefully when not available.",
        "When the dataset is empty, the section is not shown and an empty-state message is displayed."
      ]
    },
    {
      "id": "REQ-14",
      "text": "Implement the score system and alert banner: compute the total score from the currently loaded violations; when total score is greater than or equal to 5, show a red alert banner with the exact text: “MULTIPLE VIOLATIONS — DATA SENT TO RTO”.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "When total score ≥ 5:\n   Show red alert banner:\n   \"MULTIPLE VIOLATIONS — DATA SENT TO RTO\""
        ]
      },
      "acceptanceCriteria": [
        "The UI computes total score as the sum of violation.score values in the current dataset.",
        "When the computed total score is >= 5, a prominent red banner is shown with the exact required text.",
        "When total score falls below 5 (e.g., during testing with fewer violations), the banner is not shown."
      ]
    },
    {
      "id": "REQ-15",
      "text": "Add challan generation UI as a modal popup “Challan Preview” that can be opened from a violation (or the latest violation card) and displays: vehicle number, owner name, violation list, total fine, timestamp, and proof image; include a “Download PDF” button that is frontend-simulated (no real PDF generation required).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Create a modal popup challan preview containing:\n\n- Vehicle number\n- Owner name\n- Violation list\n- Total fine\n- Timestamp\n- Proof image\n\nInclude Download PDF button (frontend simulated)."
        ]
      },
      "acceptanceCriteria": [
        "A challan preview modal can be opened and closed without navigation reloads.",
        "The modal displays the required fields populated from the selected violation(s).",
        "The “Download PDF” button performs a simulated action (e.g., triggers a toast/dialog) and does not require backend support or a real PDF file."
      ]
    },
    {
      "id": "REQ-16",
      "text": "Implement notification simulation popups based on incoming violation updates: when a new violation is detected compared to the previously loaded dataset, show a popup with the exact text “Alert sent to owner”; if multiple violations condition is met (total score ≥ 5), show a popup with the exact text “Report sent to 112”.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "When violation occurs:\n   Show popup:\n   \"Alert sent to owner\"\n   If multiple violations:\n   Show popup:\n   \"Report sent to 112\""
        ]
      },
      "acceptanceCriteria": [
        "When a violation appears that was not present on the prior refresh, the UI shows a popup with the exact text “Alert sent to owner”.",
        "When total score reaches >= 5, the UI shows a popup with the exact text “Report sent to 112”.",
        "Popups do not block the UI and can be dismissed or auto-dismiss after a short time."
      ]
    },
    {
      "id": "REQ-17",
      "text": "Add React Router pages to match the requested information architecture: a Vehicle Details page (equivalent to vehicle.html) and a Challan Preview page (equivalent to challan.html), and update the navigation to include these pages where appropriate.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Pages\n   index.html → dashboard\n   vehicle.html → vehicle details\n   challan.html → challan preview"
        ]
      },
      "acceptanceCriteria": [
        "The app includes routes for vehicle details and challan preview pages accessible via in-app navigation/links.",
        "The vehicle details page shows relevant data for a selected vehicle (derived from loaded violations, at minimum vehicleNo, ownerName, mobile, and related violations if available).",
        "The challan preview page shows the challan preview content in a full-page format in addition to the modal option."
      ]
    }
  ],
  "constraints": [
    "Do not modify frontend immutable paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, and anything under frontend/src/components/ui.",
    "Keep the backend as a single Motoko actor; do not add new backend methods for this change (backend/main.mo is currently empty).",
    "Do not implement the UI as standalone pure HTML/CSS/JS files (index.html/style.css/script.js); implement the requested behavior within the existing React + TypeScript + Tailwind codebase and routing.",
    "User-facing text must be in English and must match the exact alert/popup strings provided by the user where specified."
  ],
  "nonGoals": [
    "Implementing or deploying the Node.js backend API itself.",
    "Generating a real PDF file for challan download (the Download PDF action is simulated on the frontend).",
    "Adding authentication (app remains in demo mode without login)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}